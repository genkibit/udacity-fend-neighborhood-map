<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>JSDoc:
    Source: component.googlemaps.js
  </title>

  <script src="scripts/prettify/prettify.js"> </script>
  <script src="scripts/prettify/lang-css.js"> </script>
  <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">

  <style>
    section > header {
      padding: 0;
    }
  </style>
</head>

<body>
  <div class="page-wrapper">
    <header class="page-header">
      <h1>
        Source: component.googlemaps.js
      </h1>
    </header>
    <div class="main" role="main">
      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** 
 * Application Google Maps component
 * @module component.googlemaps
 * @version 1.0.0
 */


/* global $ google ko process*/
'use strict';

/**
 * Holds the imported geolocation service module functions
 * @type {(Object)}
 */
var geolocationService = require('./service.geolocation');

/**
 * Holds the imported AppView class
 * @type {(Object)}
 */
var AppViewModel = require('./component.appview');

/**
 * Holds the current index of an Array in for-loops
 * @type {(null | Number)}
 */
var i = null;

/**
 * Holds length of an Array in for-loops
 * @type {(null | Number)}
 */
var len = null;

/**
 * Holds the map Object generated by Google Maps
 * @type {(null | Object)}
 */
var map = null;

/**
 * Holds PlaceServices API
 * @type {(null | Object)}
 */
var service = null;


/* GOOGLE MAPS
----------------------------------------------------------------------------*/
/**
 * Initial callback function for Google Maps
 * @function initMaps
 */
function initMaps() {
  if (geolocationService.checkGeolocation() === true &amp;&amp; geolocationService.checkOnlineStatus() === true) {
    navigator.geolocation.getCurrentPosition(buildMap, geolocationService.handleError);
  }
}

/**
 * Loads script tags on to the DOM (here it's only for Google Maps)
 * @function callGoogleMaps
 * @param {string} apiKey - Your Google Maps API key
 */
function callGoogleMaps(apiKey) {
  var mapsUrl = 'https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&amp;libraries=places';

  $.ajax({
    url: mapsUrl,
    dataType: 'jsonp'
  })
    .done(initMaps);
}

/**
 * Makes search results alphabetical
 * @function sortResults
 * @param {Array.&lt;Object>} dataArray - The array containing the retrieved places data
 */
function sortResults(dataArray) {
  var sortedNamesArray = [];
  var sortedDataArray = [];
  var temp, j;

  for (i = 0; i &lt; dataArray.length; i++) {
    temp = dataArray[i].name;
    sortedNamesArray.push(temp);
    // placesOpenData[temp.id] = temp.opening_hours.isOpen;
  }

  sortedNamesArray.sort();
  var lenB = sortedNamesArray.length;

  for (i = 0; i &lt; lenB; i++) {
    for (j = 0; j &lt; dataArray.length; j++) {
      if (sortedNamesArray[i] === dataArray[j].name) {
        temp = dataArray[j];
        sortedDataArray.push(temp);
        dataArray.splice(j, 1);
        temp = null;
      }
    }
  }

  return sortedDataArray;
}

/**
 * Processes search results and applies Knockout JS binding context
 * This is a request callback of nearbySearch service in buildMap()
 * @function callback
 * @param {Array.&lt;Object>} results - The array containing the retrieved places data
 * @param {Object} status - Contains the status data send back from the place request
 */
function callback(results, status) {
  var bounds = new google.maps.LatLngBounds();
  var sortedResults;
  var viewModelObj;

  if (status === 'OK') {
    sortedResults = sortResults(results);

    for (i = 0, len = sortedResults.length; i &lt; len; i++) {
      bounds.extend(sortedResults[i].geometry.location);
    }

    map.fitBounds(bounds);

    // Implementing Knockout JS /
    viewModelObj = new AppViewModel(map, sortedResults, loadMarkerData);
    ko.applyBindings(viewModelObj);
    viewModelObj.initializeAppView();
  }
  else {
    geolocationService.handleError(status);
  }
}

/**
 * Builds Google Maps object from from Javascript geolocation API response data
 * @function buildMap
 * @param {Object} posObj - Holds location data from JS geolocation response object
 */
function buildMap(posObj) {
  var lat = posObj.coords.latitude;
  var lon = posObj.coords.longitude;

  if (lat &amp;&amp; lon) {

    if (process.env.NODE_ENV === 'development') {
      lat = 37.7833;
      lon = -122.4167;
    }

    var locObj = new google.maps.LatLng(lat, lon);

    var mapProperties = {
      center: locObj,
      zoom: 15,
      disableDefaultUI: true
    };

    var request = {
      location: locObj,
      radius: 1000,
      types: ['cafe', 'bakery'],
      keyword: 'coffee'
    };

    try {
      map = new google.maps.Map(document.getElementById('map-canvas'), mapProperties);
      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(request, callback);
    }
    catch (err) {
      geolocationService.handleError(err);
    }
  }
  else {
    geolocationService.handleError('Unable to get user location.');
  }
}


/* MARKER DATA LOADER
----------------------------------------------------------------------------*/
/**
 * Loads data from Google Place Search APIs to clicked marker
 * @function loadMarkerData
 * @param {Object} mkrObj - The object containing the data for a marker
 */
function loadMarkerData(mkrObj) {
  var requestObj = {
    placeId: mkrObj.id
  };

  service.getDetails(requestObj, function (place, status) {
    var placeDataList = ['photos', 'address_components', 'formatted_phone_number', 'international_phone_number', 'price_level', 'rating', 'user_ratings_total', 'opening_hours', 'reviews', 'url'];
    var curItem = null;
    var phone = null;

    if (status === google.maps.places.PlacesServiceStatus.OK) {
      for (i = 0, len = placeDataList.length; i &lt; len; i++) {
        curItem = place[placeDataList[i]];
        if (typeof curItem === 'undefined') {
          place[placeDataList[i]] = '?';
        }
      }

      // Photos
      if (typeof place.photos === 'object') {
        place.photos.forEach(function (photo) {
          mkrObj.photos.push(photo.getUrl({
            'maxWidth': 350,
            'maxHeight': 200
          }));
        });
      }
      else {
        mkrObj.photos.push('https://lh3.googleusercontent.com/_nFDV0pen9rXCLMAw0zyVxiG-xspV2EDK1xJ1RcMm1rn3RjWvh-DJHGuVD8YIs7TMxZLLQkHBSvsoGS3yBbnV4tQmJDVx-UXW-wvOKwOULfuIO-3QbFvt-K3oVUFIjYGT7vMSMLaWg=s300-no');
        console.log('No photos for ' + place.name);
      }

      // Address, phone and homepage 
      mkrObj.address1(place.address_components[0].long_name + ' ' + place.address_components[1].long_name);
      mkrObj.address2(place.address_components[2].long_name + ', ' + place.address_components[3].short_name +
        ' ' + place.address_components[5].short_name);

      if (place.formatted_phone_number !== '?') {
        phone = place.formatted_phone_number;
      }
      else {
        phone = place.international_phone_number;
      }

      mkrObj.phone(phone);
      mkrObj.hp(place.website);

      // Price, rating and status
      if (place.price_level !== '?') {
        var priceLvl = '';
        for (i = 0; i &lt; place.price_level; i++) {
          priceLvl += '$';
        }
        mkrObj.price(priceLvl);
      }
      else {
        mkrObj.price('?');
      }

      mkrObj.ratingText(place.rating + ' (' + place.user_ratings_total + ' total ratings)');

      if (place.opening_hours.isOpen === true) {
        mkrObj.status('Now Open');
      }
      else {
        mkrObj.status('Now Closed');
      }

      // Review snippit with source link
      var clip = '';
      if (place.reviews !== '?') {
        clip = place.reviews[0].text;
        if (clip.length > 150) {
          clip = clip.slice(0, 150) + '...';
        }
        mkrObj.clipping(clip);
        mkrObj.url(place.url);
      }
      else if (place.url !== '?') {
        clip = 'View more details';
        mkrObj.clipping(clip);
        mkrObj.url(place.url);
      }
      else {
        clip = 'No comments or link available.';
      }
    }
    else {
      geolocationService.handleError(status);
    }
  });
}


module.exports = (function () {
  return {
    loadMarkerData: loadMarkerData,
    callGoogleMaps: callGoogleMaps
  }
})();</code></pre>
        </article>
    </section>




    </div>

    <nav>
      <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="component.module_appview.html">appview</a></li><li><a href="component.module_googlemaps.html">googlemaps</a></li><li><a href="component.module_markerview.html">markerview</a></li><li><a href="module-main.html">main</a></li><li><a href="service.module_geolocation.html">geolocation</a></li></ul><h3>Classes</h3><ul><li><a href="component.module_appview-AppViewModel.html">AppViewModel</a></li><li><a href="component.module_markerview-MarkerViewModel.html">MarkerViewModel</a></li></ul>
      <div class="nav__repo">
        <h3><a href="https://github.com/noelnoche/fcc-microservices">Repository</a>
          <svg class="nav__svg-icon" viewBox="0 0 92 92" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <title>Git</title>
            <g stroke="none" fill="#0a0b09">
              <path
                d="M90.155,41.965 L50.036,1.847 C47.726,-0.464 43.979,-0.464 41.667,1.847 L33.336,10.179 L43.904,20.747 C46.36,19.917 49.176,20.474 51.133,22.431 C53.102,24.401 53.654,27.241 52.803,29.706 L62.989,39.891 C65.454,39.041 68.295,39.59 70.264,41.562 C73.014,44.311 73.014,48.768 70.264,51.519 C67.512,54.271 63.056,54.271 60.303,51.519 C58.235,49.449 57.723,46.409 58.772,43.861 L49.272,34.362 L49.272,59.358 C49.942,59.69 50.575,60.133 51.133,60.69 C53.883,63.44 53.883,67.896 51.133,70.65 C48.383,73.399 43.924,73.399 41.176,70.65 C38.426,67.896 38.426,63.44 41.176,60.69 C41.856,60.011 42.643,59.497 43.483,59.153 L43.483,33.925 C42.643,33.582 41.858,33.072 41.176,32.389 C39.093,30.307 38.592,27.249 39.661,24.691 L29.243,14.271 L1.733,41.779 C-0.578,44.092 -0.578,47.839 1.733,50.15 L41.854,90.268 C44.164,92.578 47.91,92.578 50.223,90.268 L90.155,50.336 C92.466,48.025 92.466,44.275 90.155,41.965">
              </path>
            </g>
          </svg>
        </h3>
      </div>

    </nav>

    <br class="clear">

    <footer>
      Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc
        3.6.6</a>
      
      on
      Wed Oct 28 2020 21:39:22 GMT-0700 (Pacific Daylight Time)
      
    </footer>
  </div>

  <script> prettyPrint(); </script>
  <script src="scripts/linenumber.js"> </script>
</body>

</html>